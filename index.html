<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Object Detection</title>
  </head>
  <body>
    <form id="form">
      <input type="file" id="imageFileInput" />
      <button type="submit">Find Objects</button>
    </form>

    <canvas id="resultCanvas" style="margin: 5rem"></canvas>

    <script>
      document
        .querySelector("#form")
        .addEventListener("submit", async function (e) {
          e.preventDefault();
          const imageFile = document.querySelector("#imageFileInput").files[0];
          const apiResponse = await sendImageToApi(imageFile);
          const img = await loadImage(imageFile);
          draw(img, apiResponse);
        });

      function getRandomColor() {
        // Generating random values for RGB components
        const red = Math.floor(Math.random() * 256);
        const green = Math.floor(Math.random() * 256);
        const blue = Math.floor(Math.random() * 256);

        // Creating the RGB color string
        const color = `rgb(${red}, ${green}, ${blue})`;

        return color;
      }

      async function sendImageToApi(image) {
        const response = await fetch(
          "https://api-inference.huggingface.co/models/facebook/detr-resnet-50",
          {
            method: "POST",
            headers: {
              Authorization: "Bearer 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",
            },
            body: image,
          }
        );
        return response.json();
      }

      function loadImage(file) {
        return new Promise((resolve) => {
          const img = new Image();
          img.onload = () => resolve(img);
          img.src = URL.createObjectURL(file);
        });
      }

      function draw(image, apiResponse) {
        const canvas = document.getElementById("resultCanvas");
        const ctx = canvas.getContext("2d");

        // Set canvas size to image size
        canvas.width = image.width;
        canvas.height = image.height;

        // Draw the image on the canvas
        ctx.drawImage(image, 0, 0, canvas.width, canvas.height);

        // Draw rectangles based on the API response

        // xmin horizontal top left ymin vertical top left
        // xmax horizontal bottom right ymax vertical button right
        apiResponse.forEach((object) => {
          const { xmin, ymin, xmax, ymax } = object.box;
        
          let color = getRandomColor()
          ctx.fillStyle = color
          ctx.beginPath();
          ctx.rect(xmin, ymin, xmax - xmin, ymax - ymin);
        
          ctx.fillText(object.label, xmin, ymin + 10);
          
          ctx.lineWidth = 2;
          ctx.strokeStyle = color;
          ctx.stroke();
        });
      }
    </script>
  </body>
</html>
